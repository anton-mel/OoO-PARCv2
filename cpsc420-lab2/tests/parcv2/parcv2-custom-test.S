//=========================================================================
// parcv2-custom-test.S
//=========================================================================

#include "parc-macros.h"

        TEST_PARC_BEGIN

        //--------------------------------------------------------------------
        // Multiplication stall test
        //--------------------------------------------------------------------

        li    $2, 5
        li    $3, 7
        mul   $4, $2, $3
        mul   $5, $2, $3
        mul   $6, $2, $4
        
        TEST_CHECK_EQ($4, 35)
        TEST_CHECK_EQ($5, 35)
        TEST_CHECK_EQ($6, 175)

        //--------------------------------------------------------------------
        // Complex Multiplication, Division, and Memory Test
        //--------------------------------------------------------------------

        li    $2, 10
        li    $3, 5
        li    $4, 7
        li    $5, 2

        mul   $6, $2, $3
        div   $7, $6, $4

        la    $21, tdata_0

        sw    $7, 0($21)

        lw    $8, 0($21)
        mul   $9, $8, $5

        div   $10, $9, $3
        sw    $10, 4($21)

        lw    $11, 0($21)
        lw    $12, 4($21)
        mul   $13, $11, $12

        div   $14, $13, $2

        TEST_CHECK_EQ($6, 50)
        TEST_CHECK_EQ($7, 7)
        TEST_CHECK_EQ($9, 14)
        TEST_CHECK_EQ($10, 2)
        TEST_CHECK_EQ($13, 14)
        TEST_CHECK_EQ($14, 1)

        //--------------------------------------------------------------------
        // Additional tests for pipeline stalls and bypassing
        //--------------------------------------------------------------------

        div   $15, $2, $5
        mul   $16, $15, $4
        TEST_CHECK_EQ($16, 35)

        sw    $4, 8($21)
        lw    $17, 8($21)
        mul   $18, $17, $3
        TEST_CHECK_EQ($18, 35)
        
        TEST_PARC_END

        .data
        .align 4

tdata_0:  .word 0x00000000